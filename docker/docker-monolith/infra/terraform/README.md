# MsyuLuch_infra
MsyuLuch Infra repository

# Выполнено ДЗ № 6

 - [+] Основное ДЗ
 - [+] Задание со *

## В процессе сделано:
 1. Создаем файлы-шаблоны для Terraform в формате *.tf

    ```
    variables.tf - описание всех переменных проекта
    main.tf - основная конфигурация ВМ
    lb.tf - описание балансировщика
    output.tf - описание выводимых на экран значений
    ```

2. Основные команды Terraform

    ```
    $ terraform validate
    $ terraform plan
    $ terraform apply
    $ terraform apply -auto-approve=true
    $ terraform output

    ```

3. После отработки команд будет создано 2 идентичных виртуальных машины и поднят балансировщик

    Для описания нескольких одинаковых ресурсов используется `count` (ресурс или модуль будем реплицирован определенное количество раз с увеличивающимся счетчиком)

    ```
    resource "yandex_compute_instance" "app" {
        count                     = var.count_app
        name = "reddit-app${count.index + 1}"
    }
    ```


## Как запустить проект:

    Load Balancer:
    testapp_IP = 84.252.129.18

    VM 1:
    testapp_IP = 178.154.227.162
    testapp_port = 9292

    VM 2:
    testapp_IP = 178.154.224.89
    testapp_port = 9292

    1. В проект добавлены разные публикации на страницах. Работу балансировщика можно протестировать, обновляя страницу

    http://84.252.129.18/

## Как проверить работоспособность:

    http://84.252.129.18/

## PR checklist
 - [+] Выставил label с темой домашнего задания


# Выполнено ДЗ № 7

 - [+] Основное ДЗ
 - [] Задание со *

## В процессе сделано:
 1. Создали образы с предустановленными приложениями, с помощью `packer` и скриптов: `install_mongodb.sh` и `install_ruby.sh`

 2. Конфигурацию разбили на модули: app, db. Конфигурация модулей отличается только используемым образом диска, созданным на предыдущем шаге.

 3. В директории terrafrom создали директории stage, prod. В каждом одинаковый набор файлов для разворачивания двух окружений. Модули используются повторно в каждом окружении.

    ```
    variables.tf - описание переменных проекта
    main.tf - основная конфигурация ВМ
    output.tf - описание выводимых на экран значений
    ```

## Как запустить проект:

    В дирректории `stage` или `prod` выполнить команды

    ```
    $ terraform validate
    $ terraform plan
    $ terraform apply
    ```

## Как проверить работоспособность:

    Через ssh попадаем на хосты и проверяем:

    app: установлены `ruby-full ruby-bundler build-essential`
    db: установлена БД `mongodb-org` и слушается локальный порт

## PR checklist
 - [+] Выставил label с темой домашнего задания
